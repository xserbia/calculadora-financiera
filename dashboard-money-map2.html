<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xavier Serbia Money Map</title>
<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&family=Fraunces:opsz,wght@9..144,600;9..144,700;9..144,800;9..144,900&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #3956E8;
  --emerald: #10b981;
  --emerald-dark: #059669;
  --amber: #f59e0b;
  --charcoal: #18181b;
  --slate: #475569;
  --slate-light: #cbd5e1;
  --bg: #fafafa;
  --card: #ffffff;
  --border: #e2e8f0;
  --text: #0f172a;
  --text-muted: #64748b;
  --danger: #ef4444;
  --warning: #f59e0b;
  --success: #10b981;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
}

.app-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Header */
.app-header {
  background: linear-gradient(135deg, var(--primary) 0%, #2845d9 100%);
  color: white;
  padding: 2rem 2rem 0;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
}

.app-title {
  font-family: 'Fraunces', serif;
  font-size: clamp(1.75rem, 4vw, 2.5rem);
  font-weight: 800;
  margin-bottom: 0.5rem;
  background: linear-gradient(135deg, #fff 0%, #fbbf24 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.app-subtitle {
  color: var(--slate-light);
  font-size: 1rem;
  margin-bottom: 2rem;
  font-weight: 400;
}

/* Tabs */
.tabs-container {
  display: flex;
  gap: 0.5rem;
  overflow-x: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
}

.tabs-container::-webkit-scrollbar {
  display: none;
}

.tab-button {
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  padding: 1rem 1.5rem;
  font-size: 0.95rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border-bottom: 3px solid transparent;
  white-space: nowrap;
  font-family: 'DM Sans', sans-serif;
}

.tab-button:hover {
  color: rgba(255, 255, 255, 0.9);
  background: rgba(255, 255, 255, 0.05);
}

.tab-button.active {
  color: white;
  border-bottom-color: var(--emerald);
}

/* Main Content */
.main-content {
  flex: 1;
  padding: 2rem;
  max-width: 1400px;
  margin: 0 auto;
  width: 100%;
}

/* Cards */
.card {
  background: var(--card);
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  border: 1px solid var(--border);
  margin-bottom: 1.5rem;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--border);
}

.card-title {
  font-family: 'Fraunces', serif;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--charcoal);
}

.card-subtitle {
  color: var(--text-muted);
  font-size: 0.875rem;
  margin-top: 0.25rem;
}

/* Form Elements */
.form-group {
  margin-bottom: 1.25rem;
}

.form-label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--text);
  font-size: 0.9rem;
}

.form-input {
  width: 100%;
  padding: 0.75rem 1rem;
  border: 2px solid var(--border);
  border-radius: 10px;
  font-size: 1rem;
  font-family: 'DM Sans', sans-serif;
  transition: all 0.2s ease;
  background: white;
}

.form-input:focus {
  outline: none;
  border-color: var(--emerald);
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.form-input::placeholder {
  color: var(--text-muted);
}

select.form-input {
  cursor: pointer;
}

/* Buttons */
.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all 0.2s ease;
  font-family: 'DM Sans', sans-serif;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: #2845d9;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(57, 86, 232, 0.3);
}

.btn-secondary {
  background: var(--charcoal);
  color: white;
}

.btn-secondary:hover {
  background: #27272a;
  transform: translateY(-1px);
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--border);
  color: var(--text);
}

.btn-outline:hover {
  border-color: var(--emerald);
  color: var(--emerald);
}

.btn-danger {
  background: #fecaca;
  color: #991b1b;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

.btn-danger:hover {
  background: #fca5a5;
  color: #7f1d1d;
  transform: translateY(-1px);
}

.btn-small {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
}

/* Stats Grid */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-dark) 100%);
  padding: 1.5rem;
  border-radius: 12px;
  color: white;
}

.stat-label {
  font-size: 0.875rem;
  opacity: 0.9;
  margin-bottom: 0.5rem;
}

.stat-value {
  font-family: 'Fraunces', serif;
  font-size: 2rem;
  font-weight: 800;
  line-height: 1;
}

/* Table */
.table-container {
  overflow-x: auto;
  margin: 1rem 0;
}

table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
}

thead {
  background: var(--bg);
}

th {
  padding: 1rem;
  text-align: left;
  font-weight: 700;
  font-size: 0.875rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 2px solid var(--border);
}

td {
  padding: 1rem;
  border-bottom: 1px solid var(--border);
}

tbody tr:hover {
  background: var(--bg);
}

/* Grid Layouts */
.grid-2 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

/* Category Sections */
.category-section {
  background: white;
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.category-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.category-title {
  font-weight: 700;
  font-size: 1.1rem;
  color: var(--charcoal);
}

/* Summary Cards */
.summary-card {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  padding: 2rem;
  border-radius: 16px;
  margin-top: 2rem;
}

.summary-title {
  font-family: 'Fraunces', serif;
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
  color: var(--charcoal);
}

.summary-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 0;
  border-bottom: 1px solid var(--border);
}

.summary-row:last-child {
  border-bottom: none;
  margin-top: 1rem;
  padding-top: 1.5rem;
  border-top: 2px solid var(--charcoal);
}

.summary-row-label {
  font-weight: 600;
  color: var(--text);
}

.summary-row-value {
  font-family: 'Fraunces', serif;
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--charcoal);
}

.summary-row:last-child .summary-row-value {
  font-size: 1.75rem;
  color: var(--emerald);
}

/* Chart Container */
.chart-container {
  position: relative;
  height: 300px;
  margin: 1.5rem 0;
}

/* Loading State */
.loading {
  text-align: center;
  padding: 3rem;
  color: var(--text-muted);
}

/* Export Footer */
.export-footer {
  background: var(--card);
  padding: 1.5rem 2rem;
  border-top: 1px solid var(--border);
  position: sticky;
  bottom: 0;
  z-index: 10;
}

.export-footer-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  flex-wrap: wrap;
}

.export-info {
  color: var(--text-muted);
  font-size: 0.875rem;
}

.export-actions {
  display: flex;
  gap: 1rem;
}

/* Animations */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in {
  animation: fadeIn 0.3s ease-out;
}

/* Responsive */
@media (max-width: 768px) {
  .app-header {
    padding: 1.5rem 1rem 0;
  }

  .main-content {
    padding: 1rem;
  }

  .card {
    padding: 1rem;
  }

  .tab-button {
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
  }

  .stats-grid {
    grid-template-columns: 1fr;
  }

  .export-footer-content {
    flex-direction: column;
  }

  .export-actions {
    width: 100%;
  }

  .export-actions .btn {
    flex: 1;
    justify-content: center;
  }
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

::-webkit-scrollbar-track {
  background: var(--bg);
}

::-webkit-scrollbar-thumb {
  background: var(--slate-light);
  border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--slate);
}

/* Number Formatting */
.currency {
  font-family: 'Fraunces', serif;
  font-weight: 700;
  font-feature-settings: 'tnum';
}

/* Utility Classes */
.text-success { color: var(--success); }
.text-warning { color: var(--warning); }
.text-danger { color: var(--danger); }
.text-muted { color: var(--text-muted); }
.text-right { text-align: right; }
.text-center { text-align: center; }
.mb-0 { margin-bottom: 0; }
.mt-2 { margin-top: 2rem; }
.font-bold { font-weight: 700; }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef, useMemo } = React;

// ============= UTILITY FUNCTIONS =============
const formatCurrency = (value, currencyCode = 'USD') => {
  if (value === null || value === undefined || value === '') {
    const symbols = {
      'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'MXN': '$', 
      'COP': '$', 'ARS': '$', 'CLP': '$', 'PEN': 'S/', 
      'BRL': 'R$', 'CAD': 'C$'
    };
    return `${symbols[currencyCode] || '$'}0`;
  }
  const num = typeof value === 'string' ? parseFloat(value.replace(/,/g, '')) : value;
  if (isNaN(num)) {
    const symbols = {
      'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'MXN': '$', 
      'COP': '$', 'ARS': '$', 'CLP': '$', 'PEN': 'S/', 
      'BRL': 'R$', 'CAD': 'C$'
    };
    return `${symbols[currencyCode] || '$'}0`;
  }
  
  const locales = {
    'USD': 'en-US', 'EUR': 'de-DE', 'GBP': 'en-GB',
    'MXN': 'es-MX', 'COP': 'es-CO', 'ARS': 'es-AR',
    'CLP': 'es-CL', 'PEN': 'es-PE', 'BRL': 'pt-BR',
    'CAD': 'en-CA'
  };
  
  return new Intl.NumberFormat(locales[currencyCode] || 'en-US', {
    style: 'currency',
    currency: currencyCode,
    maximumFractionDigits: 0
  }).format(num);
};

const parseNumber = (value) => {
  if (value === null || value === undefined || value === '') return 0;
  const num = typeof value === 'string' ? parseFloat(value.replace(/,/g, '')) : value;
  return isNaN(num) ? 0 : num;
};

// ============= ONBOARDING MODAL COMPONENT =============
function OnboardingModal({ isOpen, onClose, onSave, initialProfile }) {
  const [formData, setFormData] = useState({
    ...initialProfile,
    parejaNombre: initialProfile.parejaNombre || '',
    parejaApellido: initialProfile.parejaApellido || '',
    parejaAvatar: initialProfile.parejaAvatar || 'üë§'
  });
  
  const avatarOptions = ['üë§', 'üë®', 'üë©', 'üßë', 'üë®‚Äçüíº', 'üë©‚Äçüíº', 'üë®‚Äçüéì', 'üë©‚Äçüéì', 'üßî', 'üë®‚Äçü¶∞', 'üë©‚Äçü¶∞', 'üë±‚Äç‚ôÇÔ∏è', 'üë±‚Äç‚ôÄÔ∏è'];
  
  const handleSubmit = (e) => {
    e.preventDefault();
    const isCouple = formData.estadoCivil === 'casado' || formData.estadoCivil === 'pareja';
    const profileToSave = {
      ...formData,
      analisisConjunto: isCouple,
      parejaNombre: isCouple ? formData.parejaNombre : '',
      parejaApellido: isCouple ? formData.parejaApellido : '',
      parejaAvatar: isCouple ? formData.parejaAvatar : 'üë§'
    };
    onSave(profileToSave);
    onClose();
  };
  
  const updateField = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  };
  
  if (!isOpen) return null;
  
  return (
    <div style={{
      position: 'fixed',
      inset: 0,
      background: 'rgba(0,0,0,0.7)',
      zIndex: 2000,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      padding: '20px',
      backdropFilter: 'blur(8px)'
    }} onClick={onClose}>
      <div style={{
        background: '#fff',
        borderRadius: '20px',
        maxWidth: '600px',
        width: '100%',
        maxHeight: '90vh',
        overflow: 'auto',
        boxShadow: '0 25px 70px rgba(0,0,0,0.5)'
      }} onClick={(e) => e.stopPropagation()}>
        
        {/* Header */}
        <div style={{padding: '2rem 2rem 1rem', borderBottom: '1px solid var(--border)', textAlign: 'center', position: 'relative'}}>
          <button 
            onClick={onClose}
            style={{
              position: 'absolute',
              top: '1rem',
              right: '1rem',
              background: 'rgba(0,0,0,0.05)',
              border: 'none',
              width: '32px',
              height: '32px',
              borderRadius: '50%',
              fontSize: '20px',
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              transition: 'all 0.2s',
              color: '#666'
            }}
            onMouseEnter={(e) => e.target.style.background = 'rgba(0,0,0,0.1)'}
            onMouseLeave={(e) => e.target.style.background = 'rgba(0,0,0,0.05)'}
          >
            √ó
          </button>
          <div style={{fontSize: '3rem', marginBottom: '1rem'}}>üëã</div>
          <img 
            src="https://xserbia.github.io/calculadora-financiera/assets/XAVIER-MONEY-MAP-LOGO-2.png" 
            alt="Xavier Serbia Money Map"
            style={{height: '70px', marginBottom: '0.75rem'}}
          />
          <div style={{color: 'var(--text-muted)', fontSize: '0.95rem'}}>Comienza tu viaje hacia la libertad financiera</div>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit} style={{padding: '2rem'}}>
          
          {/* Avatar Selection */}
          <div style={{marginBottom: '1.5rem', textAlign: 'center'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '1rem', color: '#333'}}>
              Elige tu avatar
            </label>
            <div style={{display: 'flex', gap: '0.75rem', justifyContent: 'center', flexWrap: 'wrap'}}>
              {avatarOptions.map(avatar => (
                <button
                  key={avatar}
                  type="button"
                  onClick={() => updateField('avatar', avatar)}
                  style={{
                    fontSize: '2rem',
                    width: '60px',
                    height: '60px',
                    border: formData.avatar === avatar ? '3px solid var(--primary)' : '2px solid var(--border)',
                    borderRadius: '50%',
                    background: formData.avatar === avatar ? 'rgba(59, 130, 246, 0.1)' : 'white',
                    cursor: 'pointer',
                    transition: 'all 0.2s',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center'
                  }}
                >
                  {avatar}
                </button>
              ))}
            </div>
          </div>

          {/* Name Fields */}
          <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem'}}>
            <div>
              <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                Nombre *
              </label>
              <input
                type="text"
                required
                value={formData.nombre}
                onChange={(e) => updateField('nombre', e.target.value)}
                placeholder="Juan"
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '2px solid var(--border)',
                  borderRadius: '8px',
                  fontSize: '1rem',
                  outline: 'none'
                }}
              />
            </div>
            <div>
              <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                Apellido *
              </label>
              <input
                type="text"
                required
                value={formData.apellido}
                onChange={(e) => updateField('apellido', e.target.value)}
                placeholder="P√©rez"
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '2px solid var(--border)',
                  borderRadius: '8px',
                  fontSize: '1rem',
                  outline: 'none'
                }}
              />
            </div>
          </div>

          {/* Edad */}
          <div style={{marginBottom: '1.5rem'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
              Edad *
            </label>
            <input
              type="number"
              required
              min="18"
              max="100"
              value={formData.edad}
              onChange={(e) => updateField('edad', e.target.value)}
              placeholder="30"
              style={{
                width: '100%',
                padding: '0.75rem',
                border: '2px solid var(--border)',
                borderRadius: '8px',
                fontSize: '1rem',
                outline: 'none'
              }}
            />
          </div>

          {/* Estado Civil */}
          <div style={{marginBottom: '1.5rem'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
              Estado Civil *
            </label>
            <select
              required
              value={formData.estadoCivil}
              onChange={(e) => updateField('estadoCivil', e.target.value)}
              style={{
                width: '100%',
                padding: '0.75rem',
                border: '2px solid var(--border)',
                borderRadius: '8px',
                fontSize: '1rem',
                outline: 'none',
                cursor: 'pointer',
                background: 'white'
              }}
            >
              <option value="soltero">Soltero/a</option>
              <option value="casado">Casado/a</option>
              <option value="pareja">En pareja / Uni√≥n libre</option>
              <option value="divorciado">Divorciado/a</option>
              <option value="viudo">Viudo/a</option>
            </select>
          </div>

          {/* Info box para casados/pareja */}
          {(formData.estadoCivil === 'casado' || formData.estadoCivil === 'pareja') && (
            <>
              <div style={{
                background: '#eff6ff',
                border: '2px solid var(--primary)',
                borderRadius: '12px',
                padding: '1rem',
                marginBottom: '1.5rem'
              }}>
                <div style={{display: 'flex', gap: '0.75rem', alignItems: 'flex-start'}}>
                  <span style={{fontSize: '1.5rem'}}>üí°</span>
                  <div>
                    <div style={{fontWeight: '700', marginBottom: '0.25rem', color: 'var(--primary)'}}>
                      An√°lisis Financiero Conjunto
                    </div>
                    <div style={{fontSize: '0.875rem', color: '#1e40af', lineHeight: '1.5'}}>
                      El dashboard analizar√° las finanzas de ambos como una unidad familiar. 
                      Ingresa los ingresos, gastos y activos combinados.
                    </div>
                  </div>
                </div>
              </div>

              {/* Partner Avatar Selection */}
              <div style={{marginBottom: '1.5rem', textAlign: 'center', background: '#f8fafc', padding: '1.5rem', borderRadius: '12px'}}>
                <label style={{display: 'block', fontWeight: '600', marginBottom: '1rem', color: '#333'}}>
                  Elige el avatar de tu pareja
                </label>
                <div style={{display: 'flex', gap: '0.75rem', justifyContent: 'center', flexWrap: 'wrap'}}>
                  {avatarOptions.map(avatar => (
                    <button
                      key={`partner-${avatar}`}
                      type="button"
                      onClick={() => updateField('parejaAvatar', avatar)}
                      style={{
                        fontSize: '2rem',
                        width: '60px',
                        height: '60px',
                        border: formData.parejaAvatar === avatar ? '3px solid var(--primary)' : '2px solid var(--border)',
                        borderRadius: '50%',
                        background: formData.parejaAvatar === avatar ? 'rgba(59, 130, 246, 0.1)' : 'white',
                        cursor: 'pointer',
                        transition: 'all 0.2s',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center'
                      }}
                    >
                      {avatar}
                    </button>
                  ))}
                </div>
              </div>

              {/* Partner Name Fields */}
              <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', marginBottom: '1.5rem'}}>
                <div>
                  <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                    Nombre de tu pareja *
                  </label>
                  <input
                    type="text"
                    required
                    value={formData.parejaNombre}
                    onChange={(e) => updateField('parejaNombre', e.target.value)}
                    placeholder="Mar√≠a"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      border: '2px solid var(--border)',
                      borderRadius: '8px',
                      fontSize: '1rem',
                      outline: 'none'
                    }}
                  />
                </div>
                <div>
                  <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
                    Apellido de tu pareja *
                  </label>
                  <input
                    type="text"
                    required
                    value={formData.parejaApellido}
                    onChange={(e) => updateField('parejaApellido', e.target.value)}
                    placeholder="Gonz√°lez"
                    style={{
                      width: '100%',
                      padding: '0.75rem',
                      border: '2px solid var(--border)',
                      borderRadius: '8px',
                      fontSize: '1rem',
                      outline: 'none'
                    }}
                  />
                </div>
              </div>
            </>
          )}

          {/* Dependientes */}
          <div style={{marginBottom: '2rem'}}>
            <label style={{display: 'block', fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.9rem'}}>
              N√∫mero de Dependientes
            </label>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
              <input
                type="number"
                min="0"
                max="20"
                value={formData.dependientes}
                onChange={(e) => updateField('dependientes', parseInt(e.target.value) || 0)}
                style={{
                  width: '100%',
                  padding: '0.75rem',
                  border: '2px solid var(--border)',
                  borderRadius: '8px',
                  fontSize: '1rem',
                  outline: 'none'
                }}
              />
              <span style={{fontSize: '1.25rem', minWidth: '30px'}}>
                {formData.dependientes > 0 ? 'üë∂'.repeat(Math.min(formData.dependientes, 3)) : '‚Äî'}
              </span>
            </div>
            <div style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
              Hijos, padres u otras personas que dependan econ√≥micamente de ti
            </div>
          </div>

          {/* Buttons */}
          <div style={{display: 'flex', gap: '1rem', justifyContent: 'flex-end'}}>
            <button
              type="submit"
              style={{
                background: 'var(--primary)',
                color: 'white',
                border: 'none',
                padding: '0.875rem 2rem',
                borderRadius: '8px',
                fontSize: '1rem',
                fontWeight: '700',
                cursor: 'pointer',
                flex: 1
              }}
            >
              Comenzar üöÄ
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}

// ============= MAIN APP COMPONENT =============
function App() {
  const [activeTab, setActiveTab] = useState('vistaGeneral');
  const [currency, setCurrency] = useState(() => {
    const saved = localStorage.getItem('currency');
    return saved || 'USD';
  });
  const [showHelpModal, setShowHelpModal] = useState(false);
  const [showOnboardingModal, setShowOnboardingModal] = useState(false);
  
  // User profile
  const [userProfile, setUserProfile] = useState(() => {
    const saved = localStorage.getItem('userProfile');
    return saved ? JSON.parse(saved) : {
      nombre: '',
      apellido: '',
      edad: '',
      estadoCivil: 'soltero',
      dependientes: 0,
      avatar: 'üë§',
      analisisConjunto: false,
      parejaNombre: '',
      parejaApellido: '',
      parejaAvatar: 'üë§'
    };
  });

  // Check if first time user
  useEffect(() => {
    const hasSeenOnboarding = localStorage.getItem('hasSeenOnboarding');
    if (!hasSeenOnboarding) {
      setShowOnboardingModal(true);
    }
  }, []);

  // Save user profile to localStorage
  const saveUserProfile = (profile) => {
    setUserProfile(profile);
    localStorage.setItem('userProfile', JSON.stringify(profile));
    localStorage.setItem('hasSeenOnboarding', 'true');
    
    // Sync age to ratiosData
    if (profile.edad) {
      setRatiosData(prev => ({ ...prev, edad: profile.edad }));
    }
  };

  // Clear all saved data
  const clearAllData = () => {
    if (confirm('‚ö†Ô∏è ¬øEst√°s seguro de que quieres borrar TODOS tus datos financieros?\n\nEsta acci√≥n no se puede deshacer.')) {
      localStorage.removeItem('activos');
      localStorage.removeItem('deudas');
      localStorage.removeItem('ingresos');
      localStorage.removeItem('gastos');
      localStorage.removeItem('ratiosData');
      localStorage.removeItem('modoCalculo');
      localStorage.removeItem('currency');
      localStorage.removeItem('userProfile');
      localStorage.removeItem('hasSeenOnboarding');
      
      window.location.reload();
    }
  };
  
  // ===== SHARED STATE WITH LOCALSTORAGE PERSISTENCE =====
  const [activos, setActivos] = useState(() => {
    const saved = localStorage.getItem('activos');
    return saved ? JSON.parse(saved) : {
      efectivo: [],
      inversiones: [],
      retiro: [],
      bienesRaices: [],
      bienesPersonales: []
    };
  });
  
  const [deudas, setDeudas] = useState(() => {
    const saved = localStorage.getItem('deudas');
    return saved ? JSON.parse(saved) : {
      tarjetas: [],
      lineaPersonal: [],
      lineaPropiedad: [],
      casa: [],
      auto: [],
      educacion: [],
      otros: []
    };
  });
  
  const [ingresos, setIngresos] = useState(() => {
    const saved = localStorage.getItem('ingresos');
    return saved ? JSON.parse(saved) : [];
  });
  
  const [gastos, setGastos] = useState(() => {
    const saved = localStorage.getItem('gastos');
    return saved ? JSON.parse(saved) : {
      diarios: [],
      deuda: [],
      ahorro: [],
      impuestos: [],
      seguros: []
    };
  });
  
  const [modoCalculo, setModoCalculo] = useState(() => {
    const saved = localStorage.getItem('modoCalculo');
    return saved || 'mensual';
  });
  
  const [ratiosData, setRatiosData] = useState(() => {
    const saved = localStorage.getItem('ratiosData');
    return saved ? JSON.parse(saved) : {
      edad: '',
      ingresoBruto: 0,
      ingresoNeto: 0,
      ahorroAnual: 0,
      impuestosAnual: 0,
      segurosAnual: 0,
      deudaAnual: 0,
      gastosAnual: 0,
      pagoDeudaMensual: 0,
      gastosEsencialesMensuales: 0,
      reserva: 0,
      pasivosCorrientes: 0
    };
  });

  // Auto-save to localStorage whenever data changes
  useEffect(() => {
    localStorage.setItem('activos', JSON.stringify(activos));
  }, [activos]);

  useEffect(() => {
    localStorage.setItem('deudas', JSON.stringify(deudas));
  }, [deudas]);

  useEffect(() => {
    localStorage.setItem('ingresos', JSON.stringify(ingresos));
  }, [ingresos]);

  useEffect(() => {
    localStorage.setItem('gastos', JSON.stringify(gastos));
  }, [gastos]);

  useEffect(() => {
    localStorage.setItem('ratiosData', JSON.stringify(ratiosData));
  }, [ratiosData]);

  useEffect(() => {
    localStorage.setItem('modoCalculo', modoCalculo);
  }, [modoCalculo]);

  useEffect(() => {
    localStorage.setItem('currency', currency);
  }, [currency]);

  // ===== COMPUTED VALUES =====
  const totales = useMemo(() => {
    // Activos
    const totalEfectivo = Object.values(activos.efectivo).reduce((sum, item) => sum + parseNumber(item.monto), 0);
    const totalInversiones = Object.values(activos.inversiones).reduce((sum, item) => sum + parseNumber(item.monto), 0);
    const totalRetiro = Object.values(activos.retiro).reduce((sum, item) => sum + parseNumber(item.monto), 0);
    const totalBienesRaices = Object.values(activos.bienesRaices).reduce((sum, item) => sum + parseNumber(item.monto), 0);
    const totalBienesPersonales = Object.values(activos.bienesPersonales).reduce((sum, item) => sum + parseNumber(item.monto), 0);
    const activosTotales = totalEfectivo + totalInversiones + totalRetiro + totalBienesRaices + totalBienesPersonales;
    
    // Pasivos
    const totalTarjetas = Object.values(deudas.tarjetas).reduce((sum, item) => sum + parseNumber(item.balance), 0);
    const totalLineaPersonal = Object.values(deudas.lineaPersonal).reduce((sum, item) => sum + parseNumber(item.balance), 0);
    const totalLineaPropiedad = Object.values(deudas.lineaPropiedad).reduce((sum, item) => sum + parseNumber(item.balance), 0);
    const totalCasa = Object.values(deudas.casa).reduce((sum, item) => sum + parseNumber(item.balance), 0);
    const totalAuto = Object.values(deudas.auto).reduce((sum, item) => sum + parseNumber(item.balance), 0);
    const totalEducacion = Object.values(deudas.educacion).reduce((sum, item) => sum + parseNumber(item.balance), 0);
    const totalOtros = Object.values(deudas.otros).reduce((sum, item) => sum + parseNumber(item.balance), 0);
    const pasivosTotales = totalTarjetas + totalLineaPersonal + totalLineaPropiedad + totalCasa + totalAuto + totalEducacion + totalOtros;
    
    // Patrimonio
    const patrimonioNeto = activosTotales - pasivosTotales;
    
    // Ingresos/Gastos
    const mult = modoCalculo === 'anual' ? 12 : 1;
    const totalIngresos = ingresos.reduce((sum, item) => sum + parseNumber(item.monto), 0) * mult;
    const totalAhorro = gastos.ahorro.reduce((sum, item) => sum + parseNumber(item.monto), 0) * mult;
    const totalDeudaGastos = gastos.deuda.reduce((sum, item) => sum + parseNumber(item.monto), 0) * mult;
    const totalDiarios = gastos.diarios.reduce((sum, item) => sum + parseNumber(item.monto), 0) * mult;
    const totalSeguros = gastos.seguros.reduce((sum, item) => sum + parseNumber(item.monto), 0) * mult;
    const totalImpuestos = gastos.impuestos.reduce((sum, item) => sum + parseNumber(item.monto), 0) * mult;
    const totalGastos = totalAhorro + totalDeudaGastos + totalDiarios + totalSeguros + totalImpuestos;
    const superavit = totalIngresos - totalGastos;

    return {
      activosTotales,
      pasivosTotales,
      patrimonioNeto,
      totalIngresos,
      totalGastos,
      superavit,
      totalEfectivo,
      totalInversiones,
      totalRetiro,
      totalBienesRaices,
      totalBienesPersonales,
      activosLiquidos: totalEfectivo,
      inversiones: totalInversiones + totalRetiro
    };
  }, [activos, deudas, ingresos, gastos, modoCalculo]);

  return (
    <div className="app-container">
      {/* Onboarding Modal */}
      <OnboardingModal
        isOpen={showOnboardingModal}
        onClose={() => setShowOnboardingModal(false)}
        onSave={saveUserProfile}
        initialProfile={userProfile}
      />
      
      <header className="app-header">
        <div className="header-content">
          <img 
            src="https://xserbia.github.io/calculadora-financiera/assets/XAVIER-MONEY-MAP-LOGO.png" 
            alt="Xavier Serbia Money Map"
            style={{height: '60px', marginBottom: '0.5rem'}}
          />
          <p className="app-subtitle">Tu mapa financiero personal hacia la libertad econ√≥mica</p>
          
          <div style={{display: 'flex', gap: '1rem', alignItems: 'center', marginBottom: '1.5rem'}}>
            <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
              <label style={{color: 'rgba(255,255,255,0.8)', fontSize: '0.9rem', fontWeight: '600'}}>Moneda:</label>
              <select 
                value={currency}
                onChange={(e) => setCurrency(e.target.value)}
                style={{
                  padding: '0.5rem 1rem',
                  borderRadius: '8px',
                  border: '2px solid rgba(255,255,255,0.2)',
                  background: 'rgba(255,255,255,0.1)',
                  color: 'white',
                  fontWeight: '600',
                  fontSize: '0.9rem',
                  cursor: 'pointer',
                  outline: 'none'
                }}
              >
                <option value="USD" style={{background: '#2845d9', color: 'white'}}>üá∫üá∏ USD - D√≥lar</option>
                <option value="EUR" style={{background: '#2845d9', color: 'white'}}>üá™üá∫ EUR - Euro</option>
                <option value="GBP" style={{background: '#2845d9', color: 'white'}}>üá¨üáß GBP - Libra</option>
                <option value="MXN" style={{background: '#2845d9', color: 'white'}}>üá≤üáΩ MXN - Peso Mexicano</option>
                <option value="COP" style={{background: '#2845d9', color: 'white'}}>üá®üá¥ COP - Peso Colombiano</option>
                <option value="ARS" style={{background: '#2845d9', color: 'white'}}>üá¶üá∑ ARS - Peso Argentino</option>
                <option value="CLP" style={{background: '#2845d9', color: 'white'}}>üá®üá± CLP - Peso Chileno</option>
                <option value="PEN" style={{background: '#2845d9', color: 'white'}}>üáµüá™ PEN - Sol Peruano</option>
                <option value="BRL" style={{background: '#2845d9', color: 'white'}}>üáßüá∑ BRL - Real Brasile√±o</option>
                <option value="CAD" style={{background: '#2845d9', color: 'white'}}>üá®üá¶ CAD - D√≥lar Canadiense</option>
              </select>
            </div>
            
            <button
              onClick={() => setShowOnboardingModal(true)}
              style={{
                padding: '0.5rem 1.25rem',
                borderRadius: '8px',
                border: '2px solid rgba(255,255,255,0.3)',
                background: 'rgba(255,255,255,0.15)',
                color: 'white',
                fontWeight: '600',
                fontSize: '0.9rem',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
            >
              {userProfile.avatar} Mi Perfil
            </button>
            
            <button
              onClick={() => setShowHelpModal(true)}
              style={{
                padding: '0.5rem 1.25rem',
                borderRadius: '8px',
                border: '2px solid rgba(255,255,255,0.3)',
                background: 'rgba(255,255,255,0.15)',
                color: 'white',
                fontWeight: '600',
                fontSize: '0.9rem',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
            >
              ‚ùì Ayuda
            </button>
            
            <button
              onClick={clearAllData}
              style={{
                padding: '0.5rem 1.25rem',
                borderRadius: '8px',
                border: '2px solid rgba(239, 68, 68, 0.5)',
                background: 'rgba(239, 68, 68, 0.15)',
                color: 'white',
                fontWeight: '600',
                fontSize: '0.9rem',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '0.5rem'
              }}
              title="Borrar todos los datos guardados y empezar de nuevo"
            >
              üóëÔ∏è Limpiar Datos
            </button>
          </div>
          
          <div className="tabs-container">
            <button 
              className={`tab-button ${activeTab === 'vistaGeneral' ? 'active' : ''}`}
              onClick={() => setActiveTab('vistaGeneral')}
            >
              üìä Vista General
            </button>
            <button 
              className={`tab-button ${activeTab === 'graficos' ? 'active' : ''}`}
              onClick={() => setActiveTab('graficos')}
            >
              üìà Gr√°ficos
            </button>
            <button 
              className={`tab-button ${activeTab === 'ingresos' ? 'active' : ''}`}
              onClick={() => setActiveTab('ingresos')}
            >
              üíµ Ingresos y Gastos
            </button>
            <button 
              className={`tab-button ${activeTab === 'activos' ? 'active' : ''}`}
              onClick={() => setActiveTab('activos')}
            >
              üí∞ Activos
            </button>
            <button 
              className={`tab-button ${activeTab === 'deudas' ? 'active' : ''}`}
              onClick={() => setActiveTab('deudas')}
            >
              üí≥ Pasivos
            </button>
            <button 
              className={`tab-button ${activeTab === 'balance' ? 'active' : ''}`}
              onClick={() => setActiveTab('balance')}
            >
              ‚öñÔ∏è Patrimonio Neto
            </button>
            <button 
              className={`tab-button ${activeTab === 'ratios' ? 'active' : ''}`}
              onClick={() => setActiveTab('ratios')}
            >
              üìä Ratios Financieros
            </button>
          </div>
        </div>
      </header>

      <main className="main-content fade-in">
        {activeTab === 'vistaGeneral' && (
          <div style={{padding: '2rem', textAlign: 'center'}}>
            <h2 style={{fontSize: '2rem', marginBottom: '1rem'}}>Bienvenido a Xavier Serbia Money Map</h2>
            <p style={{color: 'var(--text-muted)', marginBottom: '2rem'}}>
              Comienza ingresando tus datos en las diferentes pesta√±as para obtener un an√°lisis completo de tu situaci√≥n financiera.
            </p>
            <div className="stats-grid">
              <div className="stat-card">
                <div className="stat-label">Activos Totales</div>
                <div className="stat-value">{formatCurrency(totales.activosTotales, currency)}</div>
              </div>
              <div className="stat-card" style={{background: 'linear-gradient(135deg, var(--danger) 0%, #dc2626 100%)'}}>
                <div className="stat-label">Pasivos Totales</div>
                <div className="stat-value">{formatCurrency(totales.pasivosTotales, currency)}</div>
              </div>
              <div className="stat-card" style={{background: totales.patrimonioNeto >= 0 ? 'linear-gradient(135deg, var(--emerald) 0%, var(--emerald-dark) 100%)' : 'linear-gradient(135deg, var(--danger) 0%, #dc2626 100%)'}}>
                <div className="stat-label">Patrimonio Neto</div>
                <div className="stat-value">{formatCurrency(totales.patrimonioNeto, currency)}</div>
              </div>
            </div>
          </div>
        )}
        {activeTab === 'graficos' && (
          <div style={{padding: '2rem', textAlign: 'center'}}>
            <h2>Gr√°ficos - Pr√≥ximamente</h2>
            <p style={{color: 'var(--text-muted)'}}>
              Ingresa datos en las otras pesta√±as para generar gr√°ficos autom√°ticamente.
            </p>
          </div>
        )}
        {activeTab === 'activos' && (
          <div style={{padding: '2rem'}}>
            <h2>Activos - Secci√≥n en desarrollo</h2>
          </div>
        )}
        {activeTab === 'deudas' && (
          <div style={{padding: '2rem'}}>
            <h2>Pasivos - Secci√≥n en desarrollo</h2>
          </div>
        )}
        {activeTab === 'balance' && (
          <div style={{padding: '2rem'}}>
            <h2>Patrimonio Neto - Secci√≥n en desarrollo</h2>
          </div>
        )}
        {activeTab === 'ingresos' && (
          <div style={{padding: '2rem'}}>
            <h2>Ingresos y Gastos - Secci√≥n en desarrollo</h2>
          </div>
        )}
        {activeTab === 'ratios' && (
          <div style={{padding: '2rem'}}>
            <h2>Ratios Financieros - Secci√≥n en desarrollo</h2>
          </div>
        )}
      </main>

      {/* Help Modal */}
      {showHelpModal && (
        <div style={{
          position: 'fixed',
          inset: 0,
          background: 'rgba(0,0,0,0.7)',
          zIndex: 2000,
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          padding: '20px',
          backdropFilter: 'blur(8px)'
        }} onClick={() => setShowHelpModal(false)}>
          <div style={{
            background: '#fff',
            borderRadius: '20px',
            maxWidth: '800px',
            width: '100%',
            maxHeight: '90vh',
            overflow: 'hidden',
            display: 'flex',
            flexDirection: 'column',
            boxShadow: '0 25px 70px rgba(0,0,0,0.5)'
          }} onClick={(e) => e.stopPropagation()}>
            <div style={{padding: '24px 28px', background: 'var(--primary)', borderBottom: '1px solid var(--border)', display: 'flex', alignItems: 'center', justifyContent: 'space-between'}}>
              <div style={{fontSize: '24px', fontWeight: '800', color: 'white'}}>üó∫Ô∏è C√≥mo usar Money Map</div>
              <button onClick={() => setShowHelpModal(false)} style={{background: 'rgba(255,255,255,0.2)', border: 'none', width: '36px', height: '36px', borderRadius: '50%', fontSize: '22px', cursor: 'pointer', color: 'white'}}>√ó</button>
            </div>
            <div style={{padding: '32px', overflowY: 'auto', lineHeight: '1.7'}}>
              <h3 style={{margin: '0 0 16px', fontSize: '20px', fontWeight: '700', color: 'var(--primary)'}}>
                üéØ Objetivo
              </h3>
              <p style={{marginBottom: '24px', fontSize: '15px', color: 'var(--text)'}}>
                Esta calculadora te ayuda a obtener una foto completa de tu salud financiera.
              </p>
            </div>
          </div>
        </div>
      )}

      <footer className="export-footer">
        <div className="export-footer-content">
          <div className="export-info">
            <div className="font-bold">Xavier Serbia Money Map</div>
            <div className="text-muted" style={{fontSize: '0.85rem', marginTop: '0.25rem'}}>
              Patrimonio Neto: <span className="currency font-bold" style={{color: totales.patrimonioNeto >= 0 ? 'var(--success)' : 'var(--danger)'}}>
                {formatCurrency(totales.patrimonioNeto, currency)}
              </span>
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
