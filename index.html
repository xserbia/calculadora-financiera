<!DOCTYPE html>
<html lang="es">
<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Evaluación Financiera</title>
  <style>
    /* Estilos básicos para el formulario y resultados */
    body {
      font-family: sans-serif;
      margin: 20px;
      padding: 0;
      background-color: #f9f9f9;
    }

    .step, .resultado-categoria {
      display: none;
    }
    .active, .active-res {
      display: block;
    }

    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    #nav, #navResultados {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    #nav div, .nav-res {
      background-color: lightgray;
      border-radius: 5px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      width: 12%;
      margin: 4px;
    }

    .completed {
      background-color: green;
      color: white;
    }

    .active {
      background-color: yellow;
      color: black;
    }

    .inactive {
      background-color: lightgray;
      color: gray;
    }

    .resultado-categoria {
      border: 1px solid #ccc;
      border-radius: 10px;
      background: white;
      padding: 20px;
    }

    /* Detalles ocultos inicialmente */
    .details {
      visibility: hidden;
      opacity: 0;
      transition: visibility 0s 0.3s, opacity 0.3s ease;
      padding-left: 20px;
      margin-top: 10px;
    }

    .details.show {
      visibility: visible;
      opacity: 1;
      transition: visibility 0s, opacity 0.3s ease;
    }

    .toggle-btn {
      background-color: #007bff;
      color: white;
      padding: 5px 10px;
      border: none;
      cursor: pointer;
    }

    .toggle-btn:hover {
      background-color: #0056b3;
    }

    /* Barra de progreso */
    #progress-bar-container {
      margin-bottom: 20px;
    }

    #progress-bar {
      width: 0%;
      height: 10px;
      background-color: #4caf50;
    }
  </style>
</head>
<body>

<!-- Aquí estará todo el formulario -->
<div id="formularioContainer">
  <form id="calculadoraFormulario">
    <div id="nav">
      <div id="navInfoPersonal" class="inactive" data-target="stepInfoPersonal">Información personal</div>
      <div id="navIngresos" class="inactive" data-target="stepIngresos">Ingresos</div>
      <div id="navGastos" class="inactive" data-target="stepGastos">Gastos</div>
      <div id="navActivos" class="inactive" data-target="stepActivos">Activos</div>
      <div id="navPasivos" class="inactive" data-target="stepPasivos">Pasivos</div>
      <div id="navSeguros" class="inactive" data-target="stepSeguros">Seguros</div>
      <div id="navPatrimonio" class="inactive" data-target="stepPatrimonio">Patrimonio</div>
    </div>
    <!-- Barra de progreso -->
    <div id="progress-bar-container">
      <div id="progress-bar"></div>
    </div>
    <!-- Sección 1: Información personal -->
    <div class="step active" id="stepPersonal">
      <fieldset>
        <legend><strong>1. Información personal</strong></legend>
        <label>Edad<br><input type="number" name="edad" required></label><br><br>
        <label>Estado civil<br><input type="text" name="estado_civil" required></label><br><br>
        <label>¿Tiene dependientes?<br><input type="text" name="tiene_dependientes" required></label><br><br>
        <label>¿A qué edad desea retirarse?<br><input type="number" name="edad_retiro" required></label><br><br>
      </fieldset>
      <div class="nav-buttons">
        <button type="button" onclick="nextStep('stepIngresos')">Siguiente</button>
      </div>
    </div>

    <!-- Sección 2: Ingresos y Ahorros (Anual) -->
    <div class="step" id="stepIngresos">
      <fieldset>
        <legend><strong>2. Ingresos y ahorros (Anual)</strong></legend>
        <label>Salario<br><input type="number" name="salario" required></label><br><br>
        <label>Ingreso por negocio<br><input type="number" name="ingreso_negocio" required></label><br><br>
        <label>Bonos<br><input type="number" name="bonos" required></label><br><br>
        <label>Dividendos e intereses<br><input type="number" name="dividendos_intereses" required></label><br><br>
        <label>Renta<br><input type="number" name="renta" required></label><br><br>
        <label>Otros ingresos<br><input type="number" name="otros_ingresos" required></label><br><br>
        
        <h4>Ahorros:</h4>
        <label>Aporte anual personal al retiro<br><input type="number" name="aporte_personal_retiro" required></label><br><br>
        <label>Aporte anual del empleador al retiro<br><input type="number" name="aporte_empleador_retiro" required></label><br><br>
        <label>Otros ahorros<br><input type="number" name="otros_ahorros" required></label><br><br>
      </fieldset>
  <div class="nav-buttons">
    <button type="button" onclick="prevStep('stepPersonal')">Anterior</button>
    <button type="button" onclick="nextStep('stepGastos')">Siguiente</button>
  </div>
    </div>

    <!-- Sección 3: Gastos -->
    <div class="step" id="stepGastos">
      <fieldset>
        <legend><strong>3. Gastos</strong></legend>
        
        <!-- Sección de Pago de Deuda -->
        <div>
          <button onclick="toggleDeudaDetails()">Abrir/Cerrar Pago de Deuda</button>
          <div id="deudaDetails" style="display:none; padding-left: 20px;">
            <label>Hipoteca (o renta)<br><input type="number" name="hipoteca"></label><br><br>
            <label>Préstamo de auto<br><input type="number" name="prestamo_auto"></label><br><br>
            <label>Préstamo educativo<br><input type="number" name="prestamo_educativo"></label><br><br>
            <label>Préstamo personal<br><input type="number" name="prestamo_personal"></label><br><br>
            <label>Línea de crédito<br><input type="number" name="linea_credito"></label><br><br>
            <label>Manutención<br><input type="number" name="manutencion"></label><br><br>
            <label>Tarjetas de crédito<br><input type="number" name="tarjetas_credito"></label><br><br>
            <label>Otros<br><input type="number" name="otros_deuda"></label><br><br>
          </div>
        </div>

        <!-- Sección de Gastos Diarios -->
        <div>
          <button onclick="toggleGastosDetails()">Abrir/Cerrar Gastos Diarios</button>
          <div id="gastosDetails" style="display:none; padding-left: 20px;">
            <label>Servicio público<br><input type="number" name="servicio_publico"></label><br><br>
            <label>Cuidado de hijos<br><input type="number" name="cuidado_hijos"></label><br><br>
            <label>Mantenimiento auto<br><input type="number" name="mantenimiento_auto"></label><br><br>
            <label>Cuidado personal<br><input type="number" name="cuidado_personal"></label><br><br>
            <label>Supermercado<br><input type="number" name="supermercado"></label><br><br>
            <label>Comidas afuera<br><input type="number" name="comidas_afuera"></label><br><br>
            <label>Ropa<br><input type="number" name="ropa"></label><br><br>
            <label>Vacaciones<br><input type="number" name="vacaciones"></label><br><br>
            <label>Muebles y enseres<br><input type="number" name="muebles_enseres"></label><br><br>
            <label>Gastos Médicos y dentista<br><input type="number" name="gastos_medicos"></label><br><br>
            <label>Telecomunicaciones<br><input type="number" name="telecomunicaciones"></label><br><br>
            <label>Mantenimiento del hogar<br><input type="number" name="mantenimiento_hogar"></label><br><br>
            <label>Entretenimiento<br><input type="number" name="entretenimiento"></label><br><br>
            <label>Libros y membresía de contenido<br><input type="number" name="libros_membresia"></label><br><br>
            <label>Regalos y mesada<br><input type="number" name="regalos_mesada"></label><br><br>
            <label>Donaciones<br><input type="number" name="donaciones"></label><br><br>
            <label>Fiestas<br><input type="number" name="fiestas"></label><br><br>
            <label>Mejoras al hogar<br><input type="number" name="mejoras_hogar"></label><br><br>
            <label>Dues<br><input type="number" name="dues"></label><br><br>
            <label>Servicios profesionales<br><input type="number" name="servicios_profesionales"></label><br><br>
            <label>Gastos de mascota<br><input type="number" name="gastos_mascota"></label><br><br>
            <label>Otros<br><input type="number" name="otros_gastos_diarios"></label><br><br>
          </div>
        </div>

        <!-- Sección de Seguros -->
        <div>
          <button onclick="toggleSegurosDetails()">Abrir/Cerrar Seguros</button>
          <div id="segurosDetails" style="display:none; padding-left: 20px;">
            <label>Vida<br><input type="number" name="seguro_vida"></label><br><br>
            <label>Médico<br><input type="number" name="seguro_medico"></label><br><br>
            <label>Propiedad<br><input type="number" name="seguro_propiedad"></label><br><br>
            <label>Renta<br><input type="number" name="seguro_renta"></label><br><br>
            <label>Umbrella<br><input type="number" name="seguro_umbrella"></label><br><br>
            <label>Incapacidad<br><input type="number" name="seguro_incapacidad"></label><br><br>
            <label>Auto<br><input type="number" name="seguro_auto"></label><br><br>
            <label>Propiedad personal<br><input type="number" name="seguro_propiedad_personal"></label><br><br>
          </div>
        </div>

        <!-- Sección de Impuestos -->
        <div>
          <button onclick="toggleImpuestosDetails()">Abrir/Cerrar Impuestos</button>
          <div id="impuestosDetails" style="display:none; padding-left: 20px;">
            <label>Federal<br><input type="number" name="impuesto_federal"></label><br><br>
            <label>Seguro Social<br><input type="number" name="seguro_social"></label><br><br>
            <label>Medicare<br><input type="number" name="medicare"></label><br><br>
            <label>Estatales y locales<br><input type="number" name="impuesto_estatal_local"></label><br><br>
            <label>Propiedad<br><input type="number" name="impuesto_propiedad"></label><br><br>
            <label>Auto<br><input type="number" name="impuesto_auto"></label><br><br>
          </div>
        </div>
  <div class="nav-buttons">
    <button type="button" onclick="prevStep('stepIngresos')">Anterior</button>
    <button type="button" onclick="nextStep('stepActivos')">Siguiente</button>
  </div>
      </fieldset>
    </div>
    <!-- Sección 4: Activos -->
    <div class="step" id="stepActivos">
      <fieldset>
        <legend><strong>4. Activos</strong></legend>
        <label>Cuentas bancarias y de ahorro<br><input type="number" name="cuentas_bancarias" required></label><br><br>
        <label>Inversiones (no retiro)<br><input type="number" name="cuentas_inversion" required></label><br><br>
        <label>Cuentas de retiro<br><input type="number" name="cuentas_retiro" required></label><br><br>
        <label>Valor de la vivienda principal<br><input type="number" name="valor_vivienda" required></label><br><br>
        <label>Propiedades de alquiler<br><input type="number" name="valor_propiedades_alquiler" required></label><br><br>
        <label>Otras propiedades (vacacionales, etc.)<br><input type="number" name="valor_otros_activos" required></label><br><br>
        <label>Vehículos<br><input type="number" name="valor_vehiculos" required></label><br><br>
        <label>Otros activos (joyas, muebles, etc.)<br><input type="number" name="valor_otros" required></label><br><br>
      </fieldset>
<div class="nav-buttons">
  <button type="button" onclick="prevStep('stepGastos')">Anterior</button>
  <button type="button" onclick="nextStep('stepPasivos')">Siguiente</button>
</div>
    </div>

    <!-- Sección 5: Pasivos -->
    <div class="step" id="stepPasivos">
      <fieldset>
        <legend><strong>5. Pasivos</strong></legend>
        <label>Deuda de tarjetas de crédito<br><input type="number" name="deuda_tarjetas" required></label><br><br>
        <label>Hipotecas o alquiler<br><input type="number" name="deuda_hipotecaria" required></label><br><br>
        <label>Deuda comercial<br><input type="number" name="deuda_comercial" required></label><br><br>
        <label>Préstamos para vehículos<br><input type="number" name="deuda_vehiculos" required></label><br><br>
        <label>Deuda estudiantil<br><input type="number" name="deuda_estudios" required></label><br><br>
        <label>Otras deudas<br><input type="number" name="deuda_otros" required></label><br><br>
      </fieldset>
<div class="nav-buttons">
  <button type="button" onclick="prevStep('stepActivos')">Anterior</button>
  <button type="button" onclick="nextStep('stepSeguros')">Siguiente</button>
</div>
    </div>

    <!-- Sección 6: Seguros -->
    <div class="step" id="stepSeguros">
      <fieldset>
        <legend><strong>6. Seguros</strong></legend>
        <label>Selecciona tus seguros:<br>
          <input type="checkbox" name="seguro_vida"> Vida<br>
          <input type="checkbox" name="seguro_incapacidad"> Incapacidad<br>
          <input type="checkbox" name="seguro_ltc"> LTC<br>
          <input type="checkbox" name="seguro_hogar"> Hogar<br>
          <input type="checkbox" name="seguro_auto"> Auto<br>
          <input type="checkbox" name="seguro_umbrella"> Umbrella<br>
        </label><br>
        <label>
          <input type="checkbox" id="ningunSeguroActivo" name="ningunSeguroActivo">
          No tengo seguros actualmente
        </label>
      </fieldset>
<div class="nav-buttons">
  <button type="button" onclick="prevStep('stepPasivos')">Anterior</button>
  <button type="button" onclick="nextStep('stepPatrimonio')">Siguiente</button>
</div>
    </div>

    <!-- Sección 7: Patrimonio -->
    <div class="step" id="stepPatrimonio">
      <fieldset>
        <legend><strong>7. Patrimonio</strong></legend>
        <label>Documentos disponibles:<br>
          <input type="checkbox" name="trust"> Trust<br>
          <input type="checkbox" name="will"> Testamento<br>
          <input type="checkbox" name="advance_medical_directive"> Directiva médica anticipada<br>
          <input type="checkbox" name="power_of_attorney"> Poder legal<br>
          <input type="checkbox" name="beneficiary_designation"> Designación de beneficiarios<br>
          <input type="checkbox" name="property_deeds"> Títulos de propiedad<br>
        </label><br>
        <label>
          <input type="checkbox" id="ningunPatrimonioActivo" name="ningunPatrimonioActivo">
          No tengo documentos patrimoniales actualmente
        </label>
      </fieldset>
    <div class="nav-buttons">
      <button type="button" onclick="prevStep('stepSeguros')">Anterior</button>
      <button type="submit">Calcular</button>
    </div>
    </div>

  </form>
</div>
<!-- Aquí estará la sección de resultados -->
<div id="resultadosContainer" style="display:none;">
  <h2>Resultados de tu evaluación financiera</h2>
  <div id="navResultados">
    <div class="nav-res inactive" onclick="mostrarResultado('resA')">A. Flujo</div>
    <div class="nav-res inactive" onclick="mostrarResultado('resB')">B. Deuda</div>
    <div class="nav-res inactive" onclick="mostrarResultado('resC')">C. Patrimonio</div>
    <div class="nav-res inactive" onclick="mostrarResultado('resD')">D. Seguridad</div>
    <div class="nav-res inactive" onclick="mostrarResultado('resE')">E. Riesgo</div>
    <div class="nav-res inactive" onclick="mostrarResultado('resF')">F. Patrimonial</div>
    <div class="nav-res inactive" onclick="mostrarResultado('resG')">G. Retiro</div>
    <div class="nav-res inactive" onclick="mostrarResultado('resH')">H. Estrés</div>
  </div>

  <!-- Gráfico de Dona para la distribución de gastos -->
  <h3>Distribución de gastos</h3>
  <canvas id="graficoGastos" width="100" height="100"></canvas> <!-- Canvas para el gráfico -->
  
  <div id="resA" class="resultado-categoria active-res">[Resultados A]</div>
  <div id="resB" class="resultado-categoria">[Resultados B]</div>
  <div id="resC" class="resultado-categoria">[Resultados C]</div>
  <div id="resD" class="resultado-categoria">[Resultados D]</div>
  <div id="resE" class="resultado-categoria">[Resultados E]</div>
  <div id="resF" class="resultado-categoria">[Resultados F]</div>
  <div id="resG" class="resultado-categoria">[Resultados G]</div>
  <div id="resH" class="resultado-categoria">[Resultados H]</div>
</div>
<script>
// Función para pasar a la siguiente sección
function nextStep(stepName) {
  const steps = document.querySelectorAll('.step');
  // Ocultamos todas las secciones
  steps.forEach(stepDiv => stepDiv.classList.remove('active'));
  
  // Mostramos la sección correspondiente al nombre de la sección
  const stepToShow = document.getElementById(stepName);
  if (stepToShow) {
    stepToShow.classList.add('active');
    updateNav(stepName);
  } else {
    console.error("Sección no encontrada: " + stepName);
  }
}
// Función para actualizar la barra de progreso
function updateProgressBar(stepName, totalSteps) {
  const stepIndex = Array.from(document.querySelectorAll('.step')).indexOf(document.getElementById(stepName)) + 1; 
  const progress = (stepIndex / totalSteps) * 100;  // Calcula el porcentaje
  document.getElementById('progress-bar').style.width = progress + '%'; // Actualiza el ancho de la barra
}
// Función para volver a la sección anterior
function prevStep(stepName) {
  nextStep(stepName);
}

  // Función para actualizar la navegación en la barra de progreso
  function updateNav(step) {
    const navItems = document.querySelectorAll('#nav div');
    navItems.forEach((item, index) => {
      item.classList.remove('completed', 'active', 'inactive');
      if (index < step - 1) item.classList.add('completed');
      else if (index === step - 1) item.classList.add('active');
      else item.classList.add('inactive');
    });
  }

  // Permitir navegación directa desde el menú
  document.querySelectorAll('#nav div').forEach((navItem, index) => {
    navItem.addEventListener('click', function () {
      // Ocultamos todas las secciones
      document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));

      // Mostramos la sección correspondiente al índice
      document.querySelectorAll('.step')[index].classList.add('active');

      // Actualizamos visualmente el menú
      updateNav(index + 1);
    });
  });
  // Función para mostrar/ocultar los detalles de la deuda
  function toggleDeudaDetails() {
    var deudaDetails = document.getElementById("deudaDetails");
    deudaDetails.style.display = deudaDetails.style.display === "none" ? "block" : "none";
  }

  // Función para mostrar/ocultar los detalles de los gastos diarios
  function toggleGastosDetails() {
    var gastosDetails = document.getElementById("gastosDetails");
    gastosDetails.style.display = gastosDetails.style.display === "none" ? "block" : "none";
  }

  // Función para mostrar/ocultar los detalles de los seguros
  function toggleSegurosDetails() {
    var segurosDetails = document.getElementById("segurosDetails");
    segurosDetails.style.display = segurosDetails.style.display === "none" ? "block" : "none";
  }

  // Función para mostrar/ocultar los detalles de los impuestos
  function toggleImpuestosDetails() {
    var impuestosDetails = document.getElementById("impuestosDetails");
    impuestosDetails.style.display = impuestosDetails.style.display === "none" ? "block" : "none";
  }

  // Función para mostrar los resultados
  function mostrarResultado(id) {
    document.querySelectorAll('.resultado-categoria').forEach(div => div.classList.remove('active-res'));
    document.getElementById(id).classList.add('active-res');
    document.querySelectorAll('#navResultados .nav-res').forEach(nav => nav.classList.remove('active'));
    const current = Array.from(document.querySelectorAll('#navResultados .nav-res')).find(nav => nav.textContent.includes(id.replace('res', '')));
    if (current) current.classList.add('active');
  }

  // Evento al hacer submit del formulario
  document.getElementById("calculadoraFormulario").addEventListener("submit", function(e) {
    e.preventDefault(); // Evitar que el formulario se envíe por defecto

    const data = {};
    Array.from(this.elements).forEach(el => {
      if (el.name) {
        if (el.type === "checkbox") {
          data[el.name] = el.checked;
        } else {
          data[el.name] = el.value;
        }
      }
    });

    // Convertir los datos numéricos a valores flotantes donde sea necesario
    for (let key in data) {
      if (!isNaN(data[key])) data[key] = parseFloat(data[key]);
    }

    // Llamada a la función para mostrar el gráfico de dona con los gastos
    mostrarGraficoGastos(data);

    // Llamar a la función de cálculo
    calcularResultados(data);

    // Mostrar los resultados
    document.getElementById("resultadosContainer").style.display = "block";
    mostrarResultado("resA");
  });

// Función para mostrar el gráfico de Dona para la distribución de gastos
function mostrarGraficoGastos(data) {
  // Verifica si el canvas existe antes de intentar acceder a su contexto
  const canvas = document.getElementById('graficoGastos');
  if (!canvas) {
    console.error("El elemento canvas con id 'graficoGastos' no se encuentra.");
    return;
  }
const ctx = canvas.getContext('2d'); // Accede al contexto del canvas aquí
    // Verificación de los datos que se están pasando al gráfico
  console.log("Datos para el gráfico de dona: ", {
    pago_deuda: data.pago_deuda || 0,
    gastos_diarios: data.gastos_diarios || 0,
    seguros: data.seguros || 0,
    impuestos: data.impuestos || 0,
    ahorroPersonal: (data.aporte_personal_retiro || 0) + (data.otros_ahorros || 0)
  });
  // Crear los datos y configuración del gráfico
  const gastosData = {
    labels: ['Pago de deuda', 'Gastos diarios', 'Seguros', 'Impuestos', 'Ahorro personal'],
    datasets: [{
      label: 'Distribución de gastos',
      data: [
        data.pago_deuda || 0,  
        data.gastos_diarios || 0,  
        data.seguros || 0,  
        data.impuestos || 0,  
        (data.aporte_personal_retiro || 0) + (data.otros_ahorros || 0)  // Suma solo los ahorros personales
      ],
      backgroundColor: ['#FF5733', '#33FF57', '#3357FF', '#FF33A1', '#FFC300'],  // Incluimos un color para el ahorro personal
      hoverOffset: 4
    }]
  };

  const config = {
    type: 'doughnut',
    data: gastosData,
    options: {
      responsive: true,
      plugins: {
        legend: {
          position: 'top',
        },
        tooltip: {
          callbacks: {
            label: function(tooltipItem) {
              return tooltipItem.label + ': ' + tooltipItem.raw.toFixed(2) + '€';
            }
          }
        }
      }
    }
  };

  // Dibuja el gráfico
  new Chart(ctx, config);
}

  function calcularResultados(data) {
    calcularCategoriaA(data);
    calcularCategoriaB(data);
    calcularCategoriaC(data);
    calcularCategoriaD(data);
    calcularCategoriaE(data);
    calcularCategoriaF(data);
    calcularCategoriaG(data);
    calcularCategoriaH(data);
  }
// Función para mostrar los resultados (solo se muestra la dona en la sección de flujo)
function mostrarResultado(id) {
  // Primero, eliminamos el gráfico de dona de todas las secciones
  const canvas = document.getElementById('graficoGastos');
  if (!canvas) {
    console.error("El canvas para el gráfico de dona no se encuentra.");
    return;
  }

  if (id !== 'resA') {
    canvas.style.display = 'none'; // Ocultamos el gráfico en otras secciones
  } else {
    // Si estamos en la sección de "Flujo", mostramos el gráfico de dona
    canvas.style.display = 'block'; // Aseguramos que el gráfico se muestre en "Flujo"
    mostrarGraficoGastos(data); // Llamamos a la función para generar el gráfico
  }
  // Continuamos con la lógica de la navegación de resultados
  document.querySelectorAll('.resultado-categoria').forEach(div => div.classList.remove('active-res'));
  document.getElementById(id).classList.add('active-res');
  document.querySelectorAll('#navResultados .nav-res').forEach(nav => nav.classList.remove('active'));
  const current = Array.from(document.querySelectorAll('#navResultados .nav-res')).find(nav => nav.textContent.includes(id.replace('res', '')));
  if (current) current.classList.add('active');
}
// Función de cálculos para cada categoría
function calcularCategoriaA(data) {
  const ingresoMensual = (
    (data.salario || 0) +
    (data.ingreso_negocio || 0) +
    (data.bonos || 0) +
    (data.dividendos_intereses || 0) +
    (data.renta || 0) +
    (data.otros_ingresos || 0)
  ) / 12; // Total mensual

  // Ahorros
  const ahorroMensual = (
    (data.aporte_personal_retiro || 0) +
    (data.aporte_empleador_retiro || 0) +
    (data.otros_ahorros || 0)
  ) / 12; // Total mensual

  const gastoMensual = (
    (data.alimentos_bebidas || 0) +
    (data.transporte || 0) +
    (data.telecomunicaciones || 0) +
    (data.servicios_publicos || 0) +
    (data.seguros || 0) +
    (data.educacion || 0) +
    (data.impuestos || 0) +
    (data.servicio_deuda || 0)
  );

  const tasaAhorro = (ahorroMensual / ingresoMensual) * 100;

  // Meses de reserva
  const mesesReserva = data.cuentas_bancarias / gastoMensual;

  // Activos líquidos y ratio corriente
  const activosLiquidos = data.cuentas_bancarias + data.cuentas_inversion;
  const razonCorriente = activosLiquidos / data.deuda_tarjetas;

  // Activos totales y efectivo sobre activos
  const activosTotales = (
    data.cuentas_bancarias + data.cuentas_inversion +
    data.valor_vivienda + data.valor_propiedades_alquiler +
    data.valor_vehiculos + data.valor_otros_activos + data.valor_otros
  );
  const efectivoSobreActivos = (data.cuentas_bancarias / activosTotales) * 100;

  // ✅ Benchmarks con emojis según tu estándar
  const emojiAhorro = tasaAhorro >= 30 ? '✅' : (tasaAhorro >= 15 ? '⚠️' : '🚨');
  const emojiReserva = mesesReserva >= 12 ? '✅' : (mesesReserva >= 6 ? '⚠️' : '🚨');
  const emojiCorriente = razonCorriente >= 1 ? '✅' : '🚨';
  const emojiEfectivo = efectivoSobreActivos < 5 ? '⚠️' :
                        efectivoSobreActivos > 20 ? '🔁' : '✅';

  document.getElementById("resA").innerHTML = `
    <h3>🅰️ A. Flujo de efectivo y liquidez</h3>
    <p><strong>Ingreso mensual total:</strong> $${ingresoMensual.toFixed(2)}</p>
    <p><strong>Ahorro mensual total:</strong> $${ahorroMensual.toFixed(2)}</p>
    <p><strong>Gasto mensual estimado:</strong> $${gastoMensual.toFixed(0)}</p>
    <p><strong>Tasa de ahorro:</strong> ${tasaAhorro.toFixed(1)}% ${emojiAhorro}</p>
    <p><strong>Meses de reserva de emergencia:</strong> ${mesesReserva.toFixed(1)} meses ${emojiReserva}</p>
    <p><strong>Razón corriente:</strong> ${razonCorriente.toFixed(2)} ${emojiCorriente}</p>
    <p><strong>Efectivo sobre activos totales:</strong> ${efectivoSobreActivos.toFixed(1)}% ${emojiEfectivo}</p>
    <p style="font-size: 0.85em; color: gray;">
      ✅ Dentro del rango ideal &nbsp;&nbsp; ⚠️ Aceptable o mejorable &nbsp;&nbsp; 🚨 Riesgo o alerta &nbsp;&nbsp; 🔁 Exceso conservador
    </p>
  `;
}

function calcularCategoriaB(data) {
  const ingresoMensualBruto = data.ingreso_anual_bruto / 12;
  const ingresoMensualNeto = data.ingreso_anual_neto / 12;

  const gastoViviendaMensual = data.vivienda + data.seguros + data.impuestos;

  const porcentajeViviendaBruto = (gastoViviendaMensual / ingresoMensualBruto) * 100;
  const porcentajeViviendaNeto = (gastoViviendaMensual / ingresoMensualNeto) * 100;

  const dtiBruto = (data.servicio_deuda / ingresoMensualBruto) * 100;
  const dtiNeto = (data.servicio_deuda / ingresoMensualNeto) * 100;

  const activosTotales = (
    data.cuentas_bancarias + data.cuentas_inversion + data.cuentas_retiro +
    data.valor_vivienda + data.valor_propiedades_alquiler + data.valor_otros_activos +
    data.valor_vehiculos + data.valor_otros
  );

  const pasivosTotales = (
    data.deuda_tarjetas + data.deuda_hipotecaria + data.deuda_comercial +
    data.deuda_vehiculos + data.deuda_estudios + data.deuda_otros
  );

  const pasivosCorrientes = data.deuda_tarjetas + data.deuda_comercial + data.deuda_vehiculos + data.deuda_otros;

  const patrimonioNeto = activosTotales - pasivosTotales;

  const relacionPasivosCorrientes = (pasivosCorrientes / activosTotales) * 100;
  const relacionDeudaActivos = (pasivosTotales / activosTotales) * 100;
  const relacionDeudaPatrimonio = (pasivosTotales / patrimonioNeto) * 100;

  // Benchmarks
  const emojiViviendaNeto = porcentajeViviendaNeto <= 28 ? '✅' : '🚨';
  const emojiViviendaBruto = porcentajeViviendaBruto <= 24 ? '✅' : '🚨';

  const emojiDTINeto = dtiNeto <= 36 ? '✅' : '🚨';
  const emojiDTIBruto = dtiBruto <= 30 ? '✅' : '🚨';

  const emojiPasivosCorrientes = relacionPasivosCorrientes <= 20 ? '✅' : '⚠️';
  const emojiDeudaActivos = relacionDeudaActivos <= 50 ? '✅' : '⚠️';

  const emojiDeudaPatrimonio = 
    relacionDeudaPatrimonio <= 50 ? '✅' :
    relacionDeudaPatrimonio <= 100 ? '⚠️' : '🚨';

  // Resultado final con tabla de benchmarks
  document.getElementById("resB").innerHTML = `
    <h3>🅱️ B. Endeudamiento</h3>
    <p><strong>% Ingreso destinado a vivienda (neto):</strong> ${porcentajeViviendaNeto.toFixed(1)}% ${emojiViviendaNeto}</p>
    <p><strong>% Ingreso destinado a vivienda (bruto):</strong> ${porcentajeViviendaBruto.toFixed(1)}% ${emojiViviendaBruto}</p>
    <p><strong>DTI (neto):</strong> ${dtiNeto.toFixed(1)}% ${emojiDTINeto}</p>
    <p><strong>DTI (bruto):</strong> ${dtiBruto.toFixed(1)}% ${emojiDTIBruto}</p>
    <p><strong>Pasivos corrientes / activos totales:</strong> ${relacionPasivosCorrientes.toFixed(1)}% ${emojiPasivosCorrientes}</p>
    <p><strong>Deuda total / activos totales:</strong> ${relacionDeudaActivos.toFixed(1)}% ${emojiDeudaActivos}</p>
    <p><strong>Deuda total / patrimonio neto:</strong> ${relacionDeudaPatrimonio.toFixed(1)}% ${emojiDeudaPatrimonio}</p>

    <h4 style="margin-top: 20px;">📊 Benchmarks utilizados</h4>
    <ul style="font-size: 0.9em;">
      <li><strong>Vivienda / ingreso neto:</strong> ≤ 28% ✅</li>
      <li><strong>Vivienda / ingreso bruto:</strong> ≤ 24% ✅</li>
      <li><strong>DTI neto:</strong> ≤ 36% ✅</li>
      <li><strong>DTI bruto:</strong> ≤ 30% ✅</li>
      <li><strong>Pasivos corrientes / activos:</strong> ≤ 20% ✅</li>
      <li><strong>Deuda / activos:</strong> ≤ 50% ✅</li>
      <li><strong>Deuda / patrimonio neto:</strong>
        ≤ 50% ✅ · 51–100% ⚠️ · > 100% 🚨
      </li>
    </ul>
  `;
}

function calcularCategoriaC(data) {
  const totalActivos = (
    data.cuentas_bancarias + data.cuentas_inversion + data.cuentas_retiro +
    data.valor_vivienda + data.valor_propiedades_alquiler + data.valor_otros_activos +
    data.valor_vehiculos + data.valor_otros
  );

  const totalPasivos = (
    data.deuda_tarjetas + data.deuda_hipotecaria + data.deuda_comercial +
    data.deuda_vehiculos + data.deuda_estudios + data.deuda_otros
  );

  const patrimonioNeto = totalActivos - totalPasivos;
  const ratioPatrimonioActivos = (patrimonioNeto / totalActivos) * 100;
  const ratioPatrimonioPasivos = (patrimonioNeto / totalPasivos) * 100;

  // Benchmarks
  const emojiActivos = ratioPatrimonioActivos >= 70 ? '✅' :
                       ratioPatrimonioActivos >= 50 ? '⚠️' : '🚨';

  const emojiPasivos = ratioPatrimonioPasivos >= 200 ? '✅' :
                       ratioPatrimonioPasivos >= 100 ? '⚠️' : '🚨';

  // Mostrar resultados
  document.getElementById("resC").innerHTML = `
    <h3>🅲 C. Patrimonio neto</h3>
    <p><strong>Activos totales:</strong> $${totalActivos.toLocaleString()}</p>
    <p><strong>Pasivos totales:</strong> $${totalPasivos.toLocaleString()}</p>
    <p><strong>Patrimonio neto:</strong> $${patrimonioNeto.toLocaleString()}</p>
    <p><strong>Relación patrimonio / activos:</strong> ${ratioPatrimonioActivos.toFixed(1)}% ${emojiActivos}</p>
    <p><strong>Relación patrimonio / pasivos:</strong> ${ratioPatrimonioPasivos.toFixed(1)}% ${emojiPasivos}</p>

    <h4 style="margin-top: 20px;">📊 Benchmarks utilizados</h4>
    <ul style="font-size: 0.9em;">
      <li><strong>Relación patrimonio / activos:</strong>
        ≥ 70% ✅ · 50–69% ⚠️ · &lt; 50% 🚨
      </li>
      <li><strong>Relación patrimonio / pasivos:</strong>
        ≥ 200% ✅ · 100–199% ⚠️ · &lt; 100% 🚨
      </li>
      <li><strong>Patrimonio neto absoluto:</strong> Evaluado en función de edad, ingresos y metas.</li>
    </ul>
  `;
}

function calcularCategoriaD(data) {
  const ingresoMensual = data.ingreso_anual_neto / 12;
  const ahorroMensual = data.aporte_personal_retiro + data.aporte_empleador_retiro;
  const tasaAhorro = (ahorroMensual / ingresoMensual) * 100;

  const activosDeInversion = data.cuentas_inversion + data.cuentas_retiro + data.valor_propiedades_alquiler;
  const activosTotales = (
    data.cuentas_bancarias + data.cuentas_inversion + data.cuentas_retiro +
    data.valor_vivienda + data.valor_propiedades_alquiler + data.valor_otros_activos +
    data.valor_vehiculos + data.valor_otros
  );

  const activosDeInversionSobreTotales = (activosDeInversion / activosTotales) * 100;
  const activosDeInversionSobreIngreso = activosDeInversion / data.ingreso_anual_bruto;
  const gastosEsencialesMensuales = (
    data.alimentos_bebidas + data.transporte + data.telecomunicaciones + 
    data.servicios_publicos + data.seguros + data.educacion + data.impuestos +
    data.deuda_hipotecaria + data.deuda_tarjetas + data.deuda_comercial +
    data.deuda_vehiculos + data.deuda_estudios + data.deuda_otros
  );
  const activosDeInversionSobreGastos = activosDeInversion / gastosEsencialesMensuales;

  const patrimonioNeto = activosTotales - (data.deuda_tarjetas + data.deuda_hipotecaria + data.deuda_comercial + data.deuda_vehiculos + data.deuda_estudios + data.deuda_otros);
  const patrimonioSobreIngreso = patrimonioNeto / data.ingreso_anual_bruto;

  // Benchmarks
  const emojiAhorro = tasaAhorro >= 30 ? '✅' : (tasaAhorro >= 15 ? '⚠️' : '🚨');
  const emojiActivosInversion = activosDeInversionSobreTotales >= 50 ? '✅' : (activosDeInversionSobreTotales >= 30 ? '⚠️' : '🚨');
  const emojiActivosSobreIngreso = activosDeInversionSobreIngreso >= 1.6 ? '✅' : (activosDeInversionSobreIngreso >= 0.6 ? '⚠️' : '🚨');
  const emojiActivosSobreGastos = activosDeInversionSobreGastos >= 120 ? '✅' : (activosDeInversionSobreGastos >= 60 ? '⚠️' : '🚨');
  const emojiPatrimonioSobreIngreso = patrimonioSobreIngreso >= 3.5 ? '✅' : (patrimonioSobreIngreso >= 3 ? '⚠️' : '🚨');

  // Benchmark de Patrimonio neto / ingreso bruto según edad
  const edad = data.edad; // Asegúrate de tener esta variable de edad
  let benchmarkPatrimonioIngreso;
  if (edad <= 30) benchmarkPatrimonioIngreso = 3;
  else if (edad <= 35) benchmarkPatrimonioIngreso = 3.5;
  else if (edad <= 40) benchmarkPatrimonioIngreso = 4;
  else if (edad <= 45) benchmarkPatrimonioIngreso = 4.5;
  else if (edad <= 50) benchmarkPatrimonioIngreso = 5;
  else if (edad <= 55) benchmarkPatrimonioIngreso = 5.5;
  else benchmarkPatrimonioIngreso = 6;

  const emojiPatrimonioIngreso = patrimonioSobreIngreso >= benchmarkPatrimonioIngreso ? '✅' : '⚠️';

  // Mostrar resultados
  document.getElementById("resD").innerHTML = `
    <h3>🅳 D. Seguridad financiera</h3>
    <p><strong>Tasa de ahorro (retirement):</strong> ${tasaAhorro.toFixed(1)}% ${emojiAhorro}</p>
    <p><strong>Activos de inversión / activos totales:</strong> ${activosDeInversionSobreTotales.toFixed(1)}% ${emojiActivosInversion}</p>
    <p><strong>Activos de inversión / ingreso bruto anual:</strong> ${activosDeInversionSobreIngreso.toFixed(2)}x ${emojiActivosSobreIngreso}</p>
    <p><strong>Activos de inversión / gastos mensuales no discrecionales:</strong> ${activosDeInversionSobreGastos.toFixed(0)} meses ${emojiActivosSobreGastos}</p>
    <p><strong>Patrimonio neto / ingreso bruto anual:</strong> ${patrimonioSobreIngreso.toFixed(2)}x ${emojiPatrimonioIngreso}</p>

    <h4 style="margin-top: 20px;">📊 Benchmarks utilizados</h4>
    <ul style="font-size: 0.9em;">
      <li><strong>Tasa de ahorro:</strong> ≥ 30% ✅ · 15%–29% ⚠️ · < 15% 🚨</li>
      <li><strong>Activos de inversión / activos totales:</strong> ≥ 50% ✅ · 30%–49% ⚠️ · < 30% 🚨</li>
      <li><strong>Activos de inversión / ingreso bruto anual:</strong> ≥ 1.6x ✅ · 0.6x–1.6x ⚠️ · < 0.6x 🚨</li>
      <li><strong>Activos de inversión / gastos mensuales no discrecionales:</strong> ≥ 120 meses ✅ · 60–119 meses ⚠️ · < 60 meses 🚨</li>
      <li><strong>Patrimonio neto / ingreso bruto anual:</strong> Evaluado según edad: ${benchmarkPatrimonioIngreso}x ✅</li>
    </ul>
  `;
}

function calcularCategoriaE(data) {
  // Activos líquidos (100% valor)
  const cuentasLiquidas = data.cuentas_bancarias + data.cuentas_inversion; // 100% valor
  const activosReales = (data.valor_vivienda + data.valor_propiedades_alquiler + data.valor_otros_activos) * 0.8; // 80% valor
  const activosMenosLiquidos = (data.valor_vehiculos + data.valor_otros) * 0.5; // 50% valor
  const cuentasRetiro = data.cuentas_retiro; // 100% valor (última línea)

  // Gastos mensuales esenciales
  const gastosEsencialesMensuales = (
    data.alimentos_bebidas + data.transporte + data.telecomunicaciones + 
    data.servicios_publicos + data.seguros + data.educacion + data.impuestos +
    data.deuda_hipotecaria + data.deuda_tarjetas + data.deuda_comercial +
    data.deuda_vehiculos + data.deuda_estudios + data.deuda_otros
  );

  // Cálculo de meses de cobertura por activo
  const mesesCuentasLiquidas = cuentasLiquidas / gastosEsencialesMensuales;
  const mesesActivosReales = activosReales / gastosEsencialesMensuales;
  const mesesActivosMenosLiquidos = activosMenosLiquidos / gastosEsencialesMensuales;
  const mesesCuentasRetiro = cuentasRetiro / gastosEsencialesMensuales;

  // Total de meses de contingencia
  const totalMeses = mesesCuentasLiquidas + mesesActivosReales + mesesActivosMenosLiquidos + mesesCuentasRetiro;

  // Mostrar los resultados en barras
  document.getElementById("resE").innerHTML = `
    <h3>🅴 E. Manejo de riesgo</h3>
    <p><strong>Fondos de contingencia disponibles:</strong> ${totalMeses.toFixed(1)} meses de gastos esenciales (excluye retiro)</p>
    <p>Nota: Este cálculo incluye cuentas líquidas, activos reales parcialmente valorados y excluye cuentas de retiro.</p>

    <h4>Barras de cobertura por activos</h4>
    <div style="background-color: #007bff; height: 30px; width: ${mesesCuentasLiquidas / totalMeses * 100}%;"></div><p>Cuentas líquidas (100% valor): ${mesesCuentasLiquidas.toFixed(1)} meses</p>
    <div style="background-color: #00bfae; height: 30px; width: ${mesesActivosReales / totalMeses * 100}%;"></div><p>Activos reales (80% valor): ${mesesActivosReales.toFixed(1)} meses</p>
    <div style="background-color: #ffdd57; height: 30px; width: ${mesesActivosMenosLiquidos / totalMeses * 100}%;"></div><p>Activos menos líquidos (50% valor): ${mesesActivosMenosLiquidos.toFixed(1)} meses</p>
    <div style="background-color: #6c757d; height: 30px; width: ${mesesCuentasRetiro / totalMeses * 100}%;"></div><p>Cuentas de retiro (última línea): ${mesesCuentasRetiro.toFixed(1)} meses</p>

    <h4 style="margin-top: 20px;">📋 Checklist de cobertura de seguros y diversificación de ingresos</h4>
    <ul style="font-size: 0.9em;">
      <li><strong>Seguro médico activo:</strong> ${data.seguro_medico ? "✅ Sí" : "❌ No"}</li>
      <li><strong>Seguro de vida vigente:</strong> ${data.seguro_vida ? "✅ Sí" : "❌ No"}</li>
      <li><strong>Otros seguros clave (discapacidad, hogar, auto, umbrella):</strong> ${data.seguro_incapacidad ? "✅ Sí" : "❌ No"}</li>
      <li><strong>Acceso a fondos de contingencia alternativos:</strong> ${data.fondos_contingencia_alternativos ? "✅ Sí" : "❌ No"}</li>
      <li><strong>Diversificación de ingresos (evita dependencia única):</strong> ${data.diversificacion_ingresos ? "✅ Sí" : "❌ No"}</li>
      <li><strong>Provisión para eventos inesperados:</strong> ${data.provision_eventos ? "✅ Sí" : "❌ No"}</li>
    </ul>
  `;
}

function calcularCategoriaF(data) {
  // Lista de documentos
  const documentos = [
    { nombre: "Trust", tiene: data.trust },
    { nombre: "Testamento", tiene: data.will },
    { nombre: "Directiva médica anticipada", tiene: data.advance_medical_directive },
    { nombre: "Poder legal", tiene: data.power_of_attorney },
    { nombre: "Designación de beneficiarios", tiene: data.beneficiary_designation },
    { nombre: "Títulos de propiedad", tiene: data.property_deeds }
  ];

  // Separar documentos en los que tiene y los que faltan
  const tiene = documentos.filter(doc => doc.tiene).map(doc => doc.nombre);
  const faltan = documentos.filter(doc => !doc.tiene).map(doc => doc.nombre);

  // Mostrar los resultados
  document.getElementById("resF").innerHTML = `
    <h3>🅵 F. Planificación patrimonial</h3>

    <h4>✅ Documentos que tiene</h4>
    <ul style="font-size: 0.9em;">
      ${tiene.length > 0 ? tiene.map(doc => `<li>${doc}</li>`).join('') : '<li>No tiene documentos registrados.</li>'}
    </ul>

    <h4>❌ Documentos que faltan</h4>
    <ul style="font-size: 0.9em;">
      ${faltan.length > 0 ? faltan.map(doc => `<li>${doc}</li>`).join('') : '<li>Todos los documentos están completos.</li>'}
    </ul>
  `;
}

function calcularCategoriaG(data) {
  const edadActual = data.edad;
  const edadRetiro = data.edad_retiro;
  const anosAcumulacion = edadRetiro - edadActual;
  const anosDistribucion = 100 - edadRetiro;

  const ingresoDeseadoAnual = data.ingreso_anual_bruto * 0.7; // 70% tasa de reemplazo

  const tasaAcumulacion = 0.07;
  const tasaDistribucion = 0.04;

  const necesidadFondo = ingresoDeseadoAnual * ((1 - Math.pow(1 + tasaDistribucion, -anosDistribucion)) / tasaDistribucion);

  const fondoAcumulado = data.cuentas_retiro;
  const aportesAnuales = data.aporte_personal_retiro + data.aporte_empleador_retiro;

  const factorFuturo = (Math.pow(1 + tasaAcumulacion, anosAcumulacion) - 1) / tasaAcumulacion;
  const montoEsperado = fondoAcumulado * Math.pow(1 + tasaAcumulacion, anosAcumulacion) + aportesAnuales * factorFuturo;

  const montoFaltante = necesidadFondo - montoEsperado;
  const ahorroRequeridoAnual = montoFaltante > 0 ? montoFaltante / factorFuturo : 0;
  const ahorroRequeridoMensual = ahorroRequeridoAnual / 12;

  // Mostrar resultados
  document.getElementById("resG").innerHTML = `
    <h3>🅶 G. Futuro financiero</h3>
    <p><strong>Monto necesario al momento del retiro:</strong> $${necesidadFondo.toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
    <p><strong>Monto proyectado con ahorro actual:</strong> $${montoEsperado.toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
    <p><strong>Ahorro adicional anual requerido:</strong> $${ahorroRequeridoAnual.toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
    <p><strong>Ahorro adicional mensual requerido:</strong> $${ahorroRequeridoMensual.toLocaleString(undefined, {maximumFractionDigits: 0})}</p>
    <p><strong>Resultado preliminar:</strong> ${montoFaltante <= 0 ? '✅ Superávit' : '⚠️ Déficit'}</p>
    <p style="font-size: 0.9em; color: gray;">
      Supuestos: inflación 3%, tasa de reemplazo 70%, rendimiento acumulación 7%, distribución 4%, expectativa de vida 100 años.<br>
      Este resultado es una estimación. Para un análisis más detallado, consulta nuestra <a href="#" target="_blank">calculadora avanzada de retiro</a>.
    </p>
  `;
}

function calcularCategoriaH(data) {
  // Datos base
  const ingresoAnual = data.ingreso_anual_neto;
  const gastosAnuales = (
    data.alimentos_bebidas + data.transporte + data.telecomunicaciones + 
    data.servicios_publicos + data.seguros + data.educacion + data.impuestos +
    data.deuda_hipotecaria + data.deuda_tarjetas + data.deuda_comercial +
    data.deuda_vehiculos + data.deuda_estudios + data.deuda_otros
  ) * 12; // Gasto anual
  const deudasAnuales = (
    data.deuda_tarjetas + data.deuda_hipotecaria + data.deuda_comercial + 
    data.deuda_vehiculos + data.deuda_estudios + data.deuda_otros
  );

  // Activos no líquidos
  const activosNoLiquidos = data.valor_vivienda + data.valor_propiedades_alquiler + data.valor_otros_activos;
  
  // Escenarios de caída (Leve, Moderado, Severo)
  const escenarios = [
    { nombre: "Leve", ajusteIngreso: 0.9, ajusteActivo: 0.9 },
    { nombre: "Moderado", ajusteIngreso: 0.7, ajusteActivo: 0.7 },
    { nombre: "Severo", ajusteIngreso: 0.5, ajusteActivo: 0.5 }
  ];

  let tabla = `<h3>H. Pruebas de estrés</h3><table><thead><tr>
    <th>Escenario</th>
    <th>¿Cubre gastos?</th>
    <th>¿Cubre deudas?</th>
    <th>¿Sigue ahorrando?</th>
  </tr></thead><tbody>`;

  // Simulación de cada escenario
  escenarios.forEach(esc => {
    const ingresoAjustado = ingresoAnual * esc.ajusteIngreso;
    const activosAjustados = activosNoLiquidos * esc.ajusteActivo;
    const puedeCubrirGastos = ingresoAjustado >= gastosAnuales;
    const puedeCubrirDeudas = ingresoAjustado >= (gastosAnuales + deudasAnuales);
    const puedeAhorrar = ingresoAjustado > (gastosAnuales + deudasAnuales);

    tabla += `<tr><td>${esc.nombre}</td>
      <td>${puedeCubrirGastos ? '✅' : '🚨'}</td>
      <td>${puedeCubrirDeudas ? '✅' : '🚨'}</td>
      <td>${puedeAhorrar ? '✅' : (puedeCubrirDeudas ? '⚠️' : '🚨')}</td>
    </tr>`;
  });

  tabla += `</tbody></table>
    <p style='font-size:0.9em;'>Simulación basada en caídas del 10%, 30% y 50% en ingresos y activos no líquidos. Efectivo y equivalentes no se afectan.</p>`;

  document.getElementById("resH").innerHTML = tabla;
}
</script>
</body>
</html>
